export type VulnerabilityAttachmentType = "PROOF" | "DOCUMENTATION" | "OTHER";

export interface VulnerabilityAttachment {
  id: string;
  vulnerability_id: string;
  filename: string;
  original_name: string;
  mime_type: string;
  file_size: number;
  storage_path: string;
  is_image: boolean;
  width?: number;
  height?: number;
  normalized: boolean;
  thumbnail_path?: string;
  attachment_type: VulnerabilityAttachmentType;
  description?: string;
  uploaded_by: string;
  uploaded_by_user?: {
    id: string;
    name: string;
    email: string;
  };
  created_at: string;
  updated_at: string;
}

export interface VulnerabilityAttachmentStats {
  total_count: number;
  total_size_bytes: number;
  total_size_mb: number;
  image_count: number;
  proof_count: number;
}

export interface UploadVulnerabilityAttachmentRequest {
  file: File;
  attachment_type: VulnerabilityAttachmentType;
  description?: string;
}

export const VULNERABILITY_ATTACHMENT_TYPE_LABELS: Record<
  VulnerabilityAttachmentType,
  string
> = {
  PROOF: "Proof of Vulnerability",
  DOCUMENTATION: "Documentation",
  OTHER: "Other",
};

export const VULNERABILITY_ATTACHMENT_TYPE_DESCRIPTIONS: Record<
  VulnerabilityAttachmentType,
  string
> = {
  PROOF: "Screenshots or files demonstrating the vulnerability",
  DOCUMENTATION: "Additional documentation or references",
  OTHER: "Other supporting files",
};

export const MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB in bytes
export const MAX_FILE_SIZE_MB = 10;

export const ACCEPTED_IMAGE_TYPES = [
  "image/jpeg",
  "image/png",
  "image/gif",
  "image/webp",
];

export const ACCEPTED_FILE_TYPES = [
  ...ACCEPTED_IMAGE_TYPES,
  "application/pdf",
  "text/plain",
  "application/msword",
  "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
];

export const ACCEPTED_FILE_EXTENSIONS = [
  ".jpg",
  ".jpeg",
  ".png",
  ".gif",
  ".webp",
  ".pdf",
  ".txt",
  ".doc",
  ".docx",
];

export function formatFileSize(bytes: number): string {
  if (bytes === 0) return "0 Bytes";
  const k = 1024;
  const sizes = ["Bytes", "KB", "MB", "GB"];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return Math.round((bytes / Math.pow(k, i)) * 100) / 100 + " " + sizes[i];
}

export function getVulnerabilityAttachmentFileUrl(
  attachmentId: string,
  thumbnail: boolean = false,
): string {
  const baseUrl = process.env.NEXT_PUBLIC_API_URL || "";
  const thumbnailParam = thumbnail ? "?thumbnail=true" : "";
  return `${baseUrl}/api/v1/vulnerabilities/vulnerability-attachments/${attachmentId}/file${thumbnailParam}`;
}

export function getVulnerabilityAttachmentDownloadUrl(
  attachmentId: string,
): string {
  const baseUrl = process.env.NEXT_PUBLIC_API_URL || "";
  return `${baseUrl}/api/v1/vulnerabilities/vulnerability-attachments/${attachmentId}/download`;
}
